{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "Workflow",
  "name": "Workflow",
  "type": "object",
  "properties": {
    "Name": {
      "description": "The name of the workflow",
      "type": "string",
      "pattern": "^[A-Za-z0-9_-]+$",
      "minLength": 1,
      "maxLength": 100
    },
    "SchemaVersion": {
      "oneOf": [
        {
          "type": "string",
          "const": "1.0"
        },
        {
          "type": "number",
          "const": 1.0
        }
      ]
    },
    "RunMode": {
      "description": "The run mode the workflow uses",
      "type": "string",
      "default": "QUEUED",
      "enum": ["PARALLEL", "QUEUED", "SUPERSEDED"]
    },
    "Triggers": {
      "description": "The triggers the workflow uses",
      "type": "array",
      "items": {
        "$ref": "#/definitions/Trigger"
      }
    },
    "Actions": {
      "description": "The actions for the workflow",
      "type": "object",
      "patternProperties": {
        "^[A-Za-z0-9_-]+$": {
          "oneOf": [
            {
              "$ref": "#/definitions/Action"
            },
            {
              "$ref": "#/definitions/ActionGroup"
            }
          ]
        }
      },
      "additionalProperties": false
    }
  },
  "required": ["Name", "SchemaVersion", "Actions"],
  "definitions": {
    "ActionGroup": {
      "description": "A group of actions",
      "type": "object",
      "properties": {
        "DependsOn": {
          "$ref": "../interfaces/DependsOn.json"
        },
        "Actions": {
          "description": "The actions in the group",
          "type": "object",
          "patternProperties": {
            "^[A-Za-z0-9_-]+$": {
              "$ref": "#/definitions/Action"
            }
          },
          "additionalProperties": false
        }
      }
    },
    "Action": {
      "description": "An action in a workflow",
      "type": "object",
      "oneOf": [
        {
          "$ref": "../actions/Build.json"
        },
        {
          "$ref": "../actions/GitHubActionsRunner.json"
        },
        {
          "$ref": "../actions/ManagedTest.json"
        }
      ]
    },
    "Trigger": {
      "type": "object",
      "oneOf": [
        {
          "$ref": "../triggers/Push.json"
        },
        {
          "$ref": "../triggers/PullRequest.json"
        },
        {
          "$ref": "../triggers/Schedule.json"
        }
      ]
    }
  }
}
